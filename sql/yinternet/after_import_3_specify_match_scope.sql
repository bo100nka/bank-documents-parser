############ SPECIFY CUSTOMERS TO PROCESS

	drop table if exists yidev.customers_limit;
    
    create temporary table yidev.customers_limit as
    select distinct id
    from zakaznici
    #where id in (978)
    ;
    
    insert into yidev.customers_limit values (-1);


############ create currency rates

	drop table if exists yidev.currency_rates;

	create table yidev.currency_rates
	(
		dt_start date not null,
		dt_end date not null,
		name varchar(3) not null,
		rate_to_eur decimal(10,7) not null
	);

	insert into yidev.currency_rates values ('1980-01-01', '2008-12-31', 'SKK', 0.0331939);
	insert into yidev.currency_rates values ('2009-01-01', '2030-12-31', 'EUR', 1);

############ create unpaid invoices

	drop table if exists yidev.faktury_unpaid;
    
    create table yidev.faktury_unpaid as
    select '2024-01-01' as dt, 'abcdefghijkl' cislo, 123456 id, '123456789123' suma_s, 123456.78 as suma, '123456789123' paid_s, 12346.78 paid,'123456789123' balance_s, 123456.78 balance, 123456.78 topay,'Masaryková Veronika (2024)xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy' meno
    limit 0
	;
    
    insert into yidev.faktury_unpaid (dt, cislo, id, suma_s, paid_s, balance_s, meno) values
	 ('2020-6-1',	'010620/65',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-7-1',	'010720/64',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-7-1',	'010720/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2020-8-1',	'010820/63',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-8-1',	'010820/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2020-9-1',	'010920/174',	803003,	'200,000',	'0',	'200,000',	'Weiss Patrik (803003)')
	,('2020-9-1',	'010920/66',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-9-1',	'010920/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2020-10-1',	'011020/180',	803003,	'200,000',	'0',	'200,000',	'Weiss Patrik (803003)')
	,('2020-10-1',	'011020/155',	813004,	'150,000',	'0',	'150,000',	'Tománková Nikola (813004)')
	,('2020-10-1',	'011020/158',	8019,	'150,000',	'0',	'150,000',	'Tomečková Anna (8019)')
	,('2020-10-1',	'011020/113',	804007,	'50,000',	'0',	'50,000',	'Peťko Vladimír (804007)')
	,('2020-10-1',	'011020/69',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-10-1',	'011020/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2020-11-1',	'011120/180',	803003,	'200,000',	'0',	'200,000',	'Weiss Patrik (803003)')
	,('2020-11-1',	'011120/158',	8019,	'150,000',	'0',	'150,000',	'Tomečková Anna (8019)')
	,('2020-11-1',	'011120/114',	804007,	'50,000',	'0',	'50,000',	'Peťko Vladimír (804007)')
	,('2020-11-1',	'011120/101',	804006,	'148,900',	'5,500',	'143,400',	'Morávek Róbert (804006)')
	,('2020-11-1',	'011120/71',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-11-1',	'011120/26',	803001,	'100,000',	'200,000',	'-100,000',	'Danielová Rozália (803001)')
	,('2020-11-1',	'011120/5',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2020-12-1',	'011220/175',	8019,	'150,000',	'0',	'150,000',	'Tomečková Anna (8019)')
	,('2020-12-1',	'011220/124',	804007,	'50,000',	'0',	'50,000',	'Peťko Vladimír (804007)')
	,('2020-12-1',	'011220/109',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2020-12-1',	'011220/72',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2020-12-1',	'011220/45',	813000,	'100,000',	'0',	'100,000',	'Hába Július (813000)')
	,('2020-12-1',	'011220/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-1-1',	'010121/5',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-1-1',	'010121/127',	804007,	'50,000',	'0',	'50,000',	'Peťko Vladimír (804007)')
	,('2021-1-1',	'010121/111',	804006,	'119,900',	'0',	'119,900',	'Morávek Róbert (804006)')
	,('2021-1-1',	'010121/73',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-2-1',	'010221/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-2-1',	'010221/134',	804007,	'50,000',	'0',	'50,000',	'Peťko Vladimír (804007)')
	,('2021-2-1',	'010221/119',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2021-2-1',	'010221/79',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-3-1',	'010321/122',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2021-3-1',	'010321/126',	14018,	'50,000',	'0',	'50,000',	'Olša Oliver (14018)')
	,('2021-3-1',	'010321/80',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-3-1',	'010321/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-4-1',	'010421/127',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2021-4-1',	'010421/83',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-4-1',	'010421/5',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-5-1',	'010521/133',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2021-5-1',	'010521/88',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-5-1',	'010521/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-6-1',	'010621/135',	804006,	'148,900',	'0',	'148,900',	'Morávek Róbert (804006)')
	,('2021-6-1',	'010621/92',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-6-1',	'010621/4',	3364,	'100,000',	'0',	'100,000',	'Barkóciová Lucia (3364)')
	,('2021-6-1',	'010621/261',	804005,	'100,000',	'50,000',	'50,000',	'Tomanová Soňa (804005)')
	,('2021-7-1',	'010721/48',	2023,	'133,000',	'266,000',	'-133,000',	'Filípková Viera (2023)')
	,('2021-7-1',	'010721/98',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-7-1',	'010721/226',	804005,	'100,000',	'0',	'100,000',	'Tomanová Soňa (804005)')
	,('2021-8-1',	'010821/101',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-8-1',	'010821/45',	4184,	'100,000',	'200,000',	'-100,000',	'Farkaš Anton (4184)')
	,('2021-8-1',	'010821/32',	803001,	'100,000',	'0',	'100,000',	'Danielová Rozália (803001)')
	,('2021-8-1',	'010821/198',	808004,	'50,000',	'0',	'50,000',	'Smolinská Terézia (808004)')
	,('2021-8-1',	'010821/227',	804005,	'100,000',	'0',	'100,000',	'Tomanová Soňa (804005)')
	,('2021-8-24',	'240821001',	240821001,	'925,000',	'0',	'925,000',	'Molnár René (803010)')
	,('2021-9-1',	'010921/101',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-9-1',	'010921/271',	803010,	'100,000',	'0',	'100,000',	'Molnár René (803010)')
	,('2021-9-1',	'010921/96',	3144,	'100,000',	'0',	'100,000',	'Kalay Roman (3144)')
	,('2021-9-1',	'010921/32',	803001,	'100,000',	'0',	'100,000',	'Danielová Rozália (803001)')
	,('2021-9-1',	'010921/197',	808004,	'50,000',	'0',	'50,000',	'Smolinská Terézia (808004)')
	,('2021-9-1',	'010921/198',	803004,	'402,400',	'804,800',	'-402,400',	'Sobiehardová Ivana (803004)')
	,('2021-9-1',	'010921/226',	804005,	'100,000',	'0',	'100,000',	'Tomanová Soňa (804005)')
	,('2021-10-1',	'011021/100',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-10-1',	'011021/166',	1060,	'99,600',	'0',	'99,600',	'Polák Martin (1060)')
	,('2021-10-1',	'011021/270',	803010,	'100,000',	'0',	'100,000',	'Molnár René (803010)')
	,('2021-10-1',	'011021/95',	3144,	'100,000',	'0',	'100,000',	'Kalay Roman (3144)')
	,('2021-10-1',	'011021/32',	803001,	'100,000',	'0',	'100,000',	'Danielová Rozália (803001)')
	,('2021-10-1',	'011021/193',	808004,	'50,000',	'0',	'50,000',	'Smolinská Terézia (808004)')
	,('2021-10-1',	'011021/222',	804005,	'100,000',	'0',	'100,000',	'Tomanová Soňa (804005)')
	,('2021-11-1',	'011121/102',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-11-1',	'011121/97',	3144,	'100,000',	'0',	'100,000',	'Kalay Roman (3144)')
	,('2021-11-1',	'011121/162',	808005,	'150,000',	'0',	'150,000',	'Piaček Marián (808005)')
	,('2021-11-1',	'011121/273',	803010,	'100,000',	'0',	'100,000',	'Molnár René (803010)')
	,('2021-11-1',	'011121/34',	803001,	'100,000',	'0',	'100,000',	'Danielová Rozália (803001)')
	,('2021-11-1',	'011121/195',	808004,	'50,000',	'0',	'50,000',	'Smolinská Terézia (808004)')
	,('2021-12-1',	'011221/79',	815003,	'100,000',	'200,000',	'-100,000',	'Holoďák Stanislav (815003)')
	,('2021-12-1',	'011221/86',	1033,	'133,000',	'266,000',	'-133,000',	'Hrebenárová Bohumila (1033)')
	,('2021-12-1',	'011221/103',	3144,	'100,000',	'0',	'100,000',	'Kalay Roman (3144)')
	,('2021-12-1',	'011221/108',	8026,	'50,000',	'0',	'50,000',	'Kirová Petra (8026)')
	,('2021-12-1',	'011221/43',	807001,	'310,800',	'339,800',	'-29,000',	'Doupník Peter (807001)')
	,('2021-12-1',	'011221/164',	808002,	'50,000',	'100,000',	'-50,000',	'Némethová Lea (808002)')
	,('2021-12-1',	'011221/190',	803006,	'100,000',	'200,000',	'-100,000',	'Ralbovská Nikola (803006)')
	,('2021-12-1',	'011221/196',	806002,	'104,400',	'133,400',	'-29,000',	'Rusnáková Beatrica (806002)')
	,('2021-12-1',	'011221/165',	813015,	'150,000',	'900,000',	'-750,000',	'Nesnadný Miroslav (813015)')
	,('2021-12-1',	'011221/127',	804004,	'250,000',	'500,000',	'-250,000',	'Levársky Vladimír (804004)')
	,('2021-12-1',	'011221/158',	803010,	'100,000',	'0',	'100,000',	'Molnár René (803010)')
	,('2021-12-1',	'011221/116',	803012,	'204,400',	'354,400',	'-150,000',	'Kozánek Anton (803012)')
	,('2021-12-1',	'011221/129',	804008,	'100,000',	'0',	'100,000',	'Lišková Simona (804008)')
	,('2021-12-1',	'011221/135',	1098,	'248,500',	'277,500',	'-29,000',	'Machová Zuzana (1098)')
	,('2021-12-1',	'011221/48',	1084,	'99,600',	'199,200',	'-99,600',	'Fajnorová Magdaléna (1084)')
	,('2021-12-1',	'011221/35',	803001,	'100,000',	'0',	'100,000',	'Danielová Rozália (803001)')
	,('2021-12-1',	'011221/214',	808004,	'50,000',	'0',	'50,000',	'Smolinská Terézia (808004)')
	,('2021-12-1',	'011221/220',	7086,	'66,100',	'132,200',	'-66,100',	'Šrámková Ľubica (7086)')
	,('2021-12-1',	'011221/233',	804009,	'200,000',	'400,000',	'-200,000',	'Šulek Filip, Ing. (804009)')
	,('2021-12-1',	'011221/241',	814011,	'50,000',	'100,000',	'-50,000',	'Tikl Tibor (814011)')
	,('2021-12-1',	'011221/244',	818001,	'150,000',	'0',	'150,000',	'Tomšej Jozef (818001)')
	,('2022-1-1',	'010122/44',	807001,	'310,800',	'281,800',	'29,000',	'Doupník Peter (807001)')
	,('2022-1-1',	'010122/134',	1098,	'248,500',	'219,500',	'29,000',	'Machová Zuzana (1098)')
	,('2022-1-1',	'010122/196',	806002,	'120,900',	'91,900',	'29,000',	'Rusnáková Beatrica (806002)')
	,('2022-3-1',	'010322/205',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-4-1',	'010422/219',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-5-1',	'010522/216',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-6-1',	'010622/8',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-6-1',	'010622/307',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-6-1',	'010622/121',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-7-1',	'010722/159',	819004,	'540,000',	'0',	'540,000',	'Chropovská Ivana (819004)')
	,('2022-7-1',	'010722/8',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-7-1',	'010722/308',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-7-1',	'010722/119',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-8-1',	'010822/55',	801017,	'540,000',	'0',	'540,000',	'Kaššák Marián (801017)')
	,('2022-8-1',	'010822/8',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-8-1',	'010822/308',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-8-1',	'010822/121',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-8-1',	'010822/42',	810005,	'100,000',	'200,000',	'-100,000',	'Selecká Klára (810005)')
	,('2022-9-1',	'010922/30',	801022,	'209,900',	'11,000',	'198,900',	'Janok Ondrej (801022)')
	,('2022-9-1',	'010922/33',	804020,	'50,000',	'100,000',	'-50,000',	'Majdanová Vlasta (804020)')
	,('2022-9-1',	'010922/8',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-9-1',	'010922/305',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-9-1',	'010922/117',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-9-1',	'010922/262',	7079,	'133,000',	'0',	'133,000',	'Troiaková Antónia (7079)')
	,('2022-10-1',	'011022/180',	804001,	'255,800',	'150,000',	'105,800',	'Bučák Rastislav (804001)')
	,('2022-10-1',	'011022/36',	804020,	'50,000',	'100,000',	'-50,000',	'Majdanová Vlasta (804020)')
	,('2022-10-1',	'011022/11',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-10-1',	'011022/2',	814026,	'50,000',	'0',	'50,000',	'Peter Jarábek (814026)')
	,('2022-10-1',	'011022/306',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-10-1',	'011022/120',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-11-1',	'011122/57',	804028,	'1,080,000',	'0',	'1,080,000',	'Domov sociálnych služieb a zariadenie pre seniorov (804028)')
	,('2022-11-1',	'011122/259',	3396,	'154,400',	'19,200',	'135,200',	'Farkašová Sabína (3396)')
	,('2022-11-1',	'011122/308',	3122,	'133,000',	'9,000',	'124,000',	'Fódorová Michaela (3122)')
	,('2022-11-1',	'011122/128',	810004,	'100,000',	'300,000',	'-200,000',	'Kovár Zdenko (810004)')
	,('2022-11-1',	'011122/106',	803011,	'100,000',	'0',	'100,000',	'Kozánková Mária (803011)')
	,('2022-11-1',	'011122/92',	804020,	'50,000',	'170,900',	'-120,900',	'Majdanová Vlasta (804020)')
	,('2022-11-1',	'011122/67',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-11-1',	'011122/58',	814026,	'50,000',	'0',	'50,000',	'Peter Jarábek (814026)')
	,('2022-11-1',	'011122/362',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-11-1',	'011122/176',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-11-1',	'011122/142',	814016,	'104,400',	'158,800',	'-54,400',	'Štvrtecká Lucia (814016)')
	,('2022-11-1',	'011122/198',	814005,	'100,000',	'0',	'100,000',	'Vizváry Ivan (814005)')
	,('2022-11-1',	'011122/244',	1157,	'50,000',	'0',	'50,000',	'Vladimír Hasák - záhradníctvo AV (1157)')
	,('2022-12-1',	'011222/299',	4053,	'50,000',	'100,000',	'-50,000',	'Bardiovský Kazimír (4053)')
	,('2022-12-1',	'011222/124',	804017,	'150,000',	'300,000',	'-150,000',	'Bukaj Ivan (804017)')
	,('2022-12-1',	'011222/132',	803008,	'150,000',	'300,000',	'-150,000',	'Burianová Romana (803008)')
	,('2022-12-1',	'011222/228',	807001,	'310,800',	'339,800',	'-29,000',	'Doupník Peter (807001)')
	,('2022-12-1',	'011222/264',	3396,	'154,400',	'0',	'154,400',	'Farkašová Sabína (3396)')
	,('2022-12-1',	'011222/126',	819012,	'270,900',	'116,400',	'154,500',	'Fatura Benedikt (819012)')
	,('2022-12-1',	'011222/159',	804011,	'2,500,000',	'0',	'2,500,000',	'FÉRnet SK s.r.o. (804011)')
	,('2022-12-1',	'011222/130',	809010,	'50,000',	'280,000',	'-230,000',	'Filková Timea (809010)')
	,('2022-12-1',	'011222/312',	3122,	'133,000',	'0',	'133,000',	'Fódorová Michaela (3122)')
	,('2022-12-1',	'011222/217',	813003,	'100,000',	'50,000',	'50,000',	'Gašpárek Ján (813003)')
	,('2022-12-1',	'011222/314',	12001,	'100,000',	'200,000',	'-100,000',	'Holenka Marián (12001)')
	,('2022-12-1',	'011222/152',	815003,	'100,000',	'200,000',	'-100,000',	'Holoďák Stanislav (815003)')
	,('2022-12-1',	'011222/353',	1033,	'133,000',	'266,000',	'-133,000',	'Hrebenárová Bohumila (1033)')
	,('2022-12-1',	'011222/271',	804021,	'134,500',	'0',	'134,500',	'Husčava Filip (804021)')
	,('2022-12-1',	'011222/82',	801024,	'220,900',	'150,000',	'70,900',	'Janák Martin (801024)')
	,('2022-12-1',	'011222/69',	813024,	'154,400',	'100,000',	'54,400',	'Janočková Ľubica (813024)')
	,('2022-12-1',	'011222/131',	810004,	'100,000',	'400,000',	'-300,000',	'Kovár Zdenko (810004)')
	,('2022-12-1',	'011222/102',	803012,	'204,400',	'0',	'204,400',	'Kozánek Anton (803012)')
	,('2022-12-1',	'011222/109',	803011,	'100,000',	'0',	'100,000',	'Kozánková Mária (803011)')
	,('2022-12-1',	'011222/229',	804004,	'250,000',	'750,000',	'-500,000',	'Levársky Vladimír (804004)')
	,('2022-12-1',	'011222/326',	1098,	'248,500',	'277,500',	'-29,000',	'Machová Zuzana (1098)')
	,('2022-12-1',	'011222/95',	804020,	'120,900',	'300,000',	'-179,100',	'Majdanová Vlasta (804020)')
	,('2022-12-1',	'011222/297',	3146,	'200,000',	'300,000',	'-100,000',	'Malíková Milena (3146)')
	,('2022-12-1',	'011222/1',	804039,	'200,000',	'0',	'200,000',	'Marianna Černeková (804039)')
	,('2022-12-1',	'011222/230',	804003,	'1,890,000',	'0',	'1,890,000',	'Mesto Senica (804003)')
	,('2022-12-1',	'011222/142',	815005,	'55,500',	'5,500',	'50,000',	'Mikulíček Pavol (815005)')
	,('2022-12-1',	'011222/70',	820012,	'100,000',	'0',	'100,000',	'Murínová Veronika (820012)')
	,('2022-12-1',	'011222/155',	813015,	'150,000',	'1,950,000',	'-1,800,000',	'Nesnadný Miroslav (813015)')
	,('2022-12-1',	'011222/23',	803018,	'100,000',	'0',	'100,000',	'Pavel Macháček (803018)')
	,('2022-12-1',	'011222/61',	814026,	'50,000',	'0',	'50,000',	'Peter Jarábek (814026)')
	,('2022-12-1',	'011222/365',	815013,	'240,000',	'0',	'240,000',	'Planka Vladimír, Ing. (815013)')
	,('2022-12-1',	'011222/172',	803006,	'100,000',	'200,000',	'-100,000',	'Ralbovská Nikola (803006)')
	,('2022-12-1',	'011222/180',	813010,	'100,000',	'0',	'100,000',	'Ročáková - Hricová Eva (813010)')
	,('2022-12-1',	'011222/198',	806002,	'120,900',	'149,900',	'-29,000',	'Rusnáková Beatrica (806002)')
	,('2022-12-1',	'011222/196',	801006,	'200,000',	'0',	'200,000',	'Skurka Dušan (801006)')
	,('2022-12-1',	'011222/148',	804015,	'100,000',	'0',	'100,000',	'Smieško Peter (804015)')
	,('2022-12-1',	'011222/178',	803004,	'407,900',	'1,168,700',	'-760,800',	'Sobiehardová Ivana (803004)')
	,('2022-12-1',	'011222/268',	13069,	'100,000',	'200,000',	'-100,000',	'Sovová Zuzana (13069)')
	,('2022-12-1',	'011222/317',	7086,	'66,100',	'0',	'66,100',	'Šrámková Ľubica (7086)')
	,('2022-12-1',	'011222/145',	814016,	'104,400',	'200,000',	'-95,600',	'Štvrtecká Lucia (814016)')
	,('2022-12-1',	'011222/163',	804009,	'200,000',	'400,000',	'-200,000',	'Šulek Filip, Ing. (804009)')
	,('2022-12-1',	'011222/190',	809005,	'154,400',	'54,400',	'100,000',	'Surový Andrej (809005)')
	,('2022-12-1',	'011222/160',	814011,	'50,000',	'100,000',	'-50,000',	'Tikl Tibor (814011)')
	,('2022-12-1',	'011222/111',	801019,	'240,000',	'480,000',	'-240,000',	'Vachová Martina (801019)')
	,('2022-12-1',	'011222/309',	9030,	'133,000',	'266,000',	'-133,000',	'Vašica Ľubomír (9030)')
	,('2022-12-1',	'011222/116',	815007,	'258,700',	'233,800',	'24,900',	'Vidovičová Katarína (815007)')
	,('2022-12-1',	'011222/248',	1157,	'50,000',	'0',	'50,000',	'Vladimír Hasák - záhradníctvo AV (1157)')
	,('2022-12-1',	'011222/104',	813021,	'305,800',	'611,600',	'-305,800',	'Vojt Stanislav (813021)')
	;

    update yidev.faktury_unpaid
    set 
		suma = cast(replace(suma_s, ',', '') as decimal(14,2)) / 10000
        ,paid = cast(replace(paid_s, ',', '') as decimal(14,2)) / 10000
        ,balance = cast(replace(balance_s, ',', '') as decimal(14,2)) / 10000
        ,topay = balance
    ;
    
    #select * from yidev.faktury_unpaid;
    #select cislo, count(*) x from yidev.faktury_unpaid group by cislo having x > 1
    #select f.* from yidev.faktury_unpaid f left join faktury fn on fn.cislo = f.cislo where fn.id is null
    
    #select * from faktury where cislo = '011221/158';
    #select * from yellownet.faktury where cislo = '011221/158';
    #select * from yellownet.zakaznici where id = 1290
    
    drop table if exists yidev.faktury_unpaid_ids;
    
    create temporary table yidev.faktury_unpaid_ids as
    select id, cislo from faktury where cislo in (select cislo from yidev.faktury_unpaid);
    
    update yidev.faktury_unpaid s
    join yidev.faktury_unpaid_ids f on f.cislo = s.cislo
    set s.id = f.id;
    
    insert into yidev.faktury_unpaid (dt, id, cislo, suma, topay)
    select date_format(d_fakt, '%Y-%m-%d'), id, cislo, suma, suma as topay
    from faktury
    where d_fakt >= '20230101'
    ;


############ create new invoices

	drop table if exists yidev.faktury_new;
    
    create table yidev.faktury_new as
    select f.id, f.id_zak, f.cislo, f.d_fakt, f.d_splat, f.suma as suma_orig, u.topay as suma, f.id_sluzby, f.d_platne_do, f.zlava, f.cena_sluzby, f.stav, f.dph, f.cena_bez_dph, f.uhradena
    from faktury f 
    join yidev.faktury_unpaid u on u.id = f.id
    where u.topay > 0
    ;
    
    #select * from yidev.faktury_new where suma != suma_orig


############ create unused payments

	drop table if exists yidev.platby_unused;
    
    create table yidev.platby_unused as
    
	select p.id, p.suma, cast(null as decimal(10, 2)) as suma_adjusted
	from yidev.platby_new p
	where datum_platby >= '20230101'
    ;
    
    # adjust manual failures reported from omega after pairing
    #update yidev.platby_unused set suma_adjusted = 0 where id = 9442; # buzkova
    #update yidev.platby_unused set suma_adjusted = 15.45 where id = 12520; # wolfova
    #update yidev.platby_unused set suma_adjusted = 10 where id = 9739; # baxevanis
    
    #select * from yidev.platby_new where id_customer in (1238,746,680) and datum_platby in ('2023-01-31','2023-06-10','2023-02-11');
    #select * from zakaznici where zmluva in (13104,12011,2136);
    

############ create temp of invoices

	drop table if exists yidev.faktury_source;

	create temporary table yidev.faktury_source as

	SELECT f.id,
		id_zak,
		f.cislo,
		d_fakt,
		d_splat,
        suma_orig,
		topay as suma_old,
		round(topay * rate_to_eur, 2) as suma,
		id_sluzby,
		d_platne_do,
		zlava,
		cena_sluzby,
		stav,
		dph,
		cena_bez_dph,
		uhradena
		,row_number() over(partition by id_zak order by d_fakt) as step 
	from yidev.faktury_new as f
	join yidev.currency_rates on d_fakt between dt_start and dt_end
    join yidev.customers_limit as cl on cl.id = f.id_zak
    join yidev.faktury_unpaid as fu on fu.id = f.id
    order by d_fakt
	;

############ create temp of payments

	drop table if exists yidev.platby_source;

	create temporary table yidev.platby_source as
	select 
		p.id,
		id_customer,
		coalesce(suma_adjusted, p.suma) as suma_old,
		round(coalesce(suma_adjusted, p.suma) * rate_to_eur, 2) as suma,
		vs,
		ss,
		datum_platby,
		zdroj,
		file,
		day_index,
		popis,
		account,
		bank,
		sender,
		iban
		,row_number() over(partition by id_customer order by datum_platby) as step 
	from yidev.platby_new as p
	join yidev.currency_rates on datum_platby between dt_start and dt_end
    join yidev.customers_limit as cl on cl.id = p.id_customer
    join yidev.platby_unused as pu on pu.id = p.id
    order by datum_platby
	;
